<mat-card>
  <ng-container *ngIf="alreadyLinked; else linkFlow">
    <h2>Аккаунт уже привязан</h2>
    <p>Вы уже вошли через Telegram. Повторная привязка не требуется.</p>
    <p *ngIf="currentChatId as chatId"><b>Текущий chatId:</b> {{ chatId }}</p>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="goHistory()">
        <mat-icon>history</mat-icon> К истории
      </button>
      <button mat-stroked-button color="primary" (click)="relinkTelegram()">
        <mat-icon>link</mat-icon> Перепривязать Telegram
      </button>
      <button mat-button (click)="logout()">
        <mat-icon>logout</mat-icon> Выйти
      </button>
    </div>
  </ng-container>
  <ng-template #linkFlow>
  <h2>Телеграм бот</h2>
  <p><b>@CalorieJournal_bot</b> связывает ваш Telegram с приложением и подтягивает вашу историю питания.</p>
  <p>После линковки вы сможете быстро входить в аккаунт, синхронизировать данные между устройствами и продолжать работу без повторной настройки.</p>
  <p>Нажмите кнопку ниже: откроется бот, код передастся автоматически, а вход завершится после подтверждения.</p>
  <div class="actions">
    <button mat-raised-button color="primary" (click)="openBotWithFreshCode()" [disabled]="busy || !code">
      <mat-icon>send</mat-icon> Открыть бота
    </button>
  </div>
  <div class="pending" *ngIf="busy">
    <mat-progress-spinner mode="indeterminate" diameter="28"></mat-progress-spinner>
    <span>Ждём подтверждение…</span>
  </div>
  <p class="expires" *ngIf="expiresAt">Код действителен до: {{ expiresAt | date:'medium' }}</p>
  </ng-template>
</mat-card>
