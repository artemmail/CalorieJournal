<mat-card>
  <mat-tab-group>
    <mat-tab label="Автоматически">
      <h2>Вход через Telegram</h2>
      <p>Нажмите кнопку, чтобы открыть бота и подтвердить вход.</p>
      <div class="actions">
        <button mat-raised-button color="primary" (click)="openBotWithFreshCode()" [disabled]="busy || !code">
          <mat-icon>send</mat-icon> Открыть бота
        </button>
      </div>
      <div class="pending" *ngIf="busy">
        <mat-progress-spinner mode="indeterminate" diameter="28"></mat-progress-spinner>
        <span>Ждём подтверждение…</span>
      </div>
      <p class="expires" *ngIf="expiresAt">Код действителен до: {{ expiresAt | date:'medium' }}</p>
    </mat-tab>
    <mat-tab label="Вручную">
      <h2>Вход через Telegram вручную</h2>
      <p>Если автоматический вход не сработал, выполните шаги вручную:</p>
      <p>1) Скопируй код и отправь его боту как команду <code>/start &lt;код&gt;</code> (или просто отправь код).</p>

      <div class="code-pill" *ngIf="code">{{ code }}</div>
      <div class="actions">
        <button mat-raised-button color="primary" (click)="copyCode()" [disabled]="!code">
          <mat-icon>content_copy</mat-icon> Скопировать
        </button>
        <button mat-stroked-button color="primary" (click)="openBot()" [disabled]="!code">
          <mat-icon>send</mat-icon> Открыть бота
        </button>
        <button mat-flat-button color="accent" (click)="refresh()" [disabled]="busy || !code">
          <mat-icon>sync</mat-icon> Обновить статус
        </button>
        <button mat-button (click)="restart()" [disabled]="busy">
          <mat-icon>autorenew</mat-icon> Запросить новый код
        </button>
      </div>

      <div class="pending" *ngIf="busy">
        <mat-progress-spinner mode="indeterminate" diameter="28"></mat-progress-spinner>
        <span>Ждём подтверждение…</span>
      </div>

      <p class="expires" *ngIf="expiresAt">Код действителен до: {{ expiresAt | date:'medium' }}</p>
    </mat-tab>
    <mat-tab label="Без Telegram">
      <h2>Вход через внешний аккаунт</h2>
      <p>Авторизуйтесь с помощью другого провайдера (например, VK). Мы создадим или найдём ваш профиль и выдадим токен входа.</p>

      <div class="external-form">
        <mat-form-field appearance="outline">
          <mat-label>Провайдер</mat-label>
          <mat-select [(ngModel)]="externalProvider" name="provider">
            <mat-option *ngFor="let p of providerOptions" [value]="p">
              {{ p === 'vk' ? 'VK' : 'Telegram' }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>ID внешнего аккаунта</mat-label>
          <input matInput [(ngModel)]="externalId" name="externalId" autocomplete="off" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Имя пользователя (опционально)</mat-label>
          <input matInput [(ngModel)]="externalUsername" name="externalUsername" autocomplete="off" />
        </mat-form-field>

        <div class="external-actions">
          <button mat-raised-button color="primary" (click)="loginExternal()" [disabled]="externalBusy || !externalProvider || !externalId.trim()">
            <mat-icon>login</mat-icon> Войти
          </button>
          <mat-progress-spinner *ngIf="externalBusy" mode="indeterminate" diameter="28"></mat-progress-spinner>
          <span class="error" *ngIf="externalError">{{ externalError }}</span>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-card>
