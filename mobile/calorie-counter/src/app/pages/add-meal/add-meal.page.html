<div class="camera-container">
  <div #previewBox id="cameraPreview" class="preview-box"></div>

  <div class="preview-overlay" *ngIf="previewActive">
    <div class="preview-hint">
      <mat-icon>info</mat-icon>
      <span>Наведите камеру на блюдо и нажмите на кнопку, чтобы сделать снимок.</span>
    </div>
    <div class="preview-controls">
      <button mat-mini-fab color="accent" (click)="openNextClarifyDialog()"
              matTooltip="Добавить уточнение к следующему фото" aria-label="Уточнение к следующему фото">
        <mat-icon>note_add</mat-icon>
      </button>
      <button mat-mini-fab color="accent" (click)="openClarifyDialog()" [disabled]="clarifyLoading"
              matTooltip="Изменить время или уточнение последнего фото" aria-label="Редактировать уточнение">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-fab color="primary" (click)="captureFromPreview()" matTooltip="Сделать фото" aria-label="Сделать фото">
        <mat-icon>camera</mat-icon>
      </button>
      <button mat-mini-fab color="primary" (click)="takePhotoSystem()" matTooltip="Открыть системную камеру" aria-label="Системная камера">
        <mat-icon>photo_camera</mat-icon>
      </button>
    </div>
  </div>

  <div class="preview-overlay inactive" *ngIf="!previewActive">
    <div class="preview-hint">
      <mat-icon>warning</mat-icon>
      <span>Предпросмотр недоступен. Попробуйте включить его снова или воспользуйтесь системной камерой.</span>
    </div>
    <div class="preview-controls">
      <button mat-mini-fab color="accent" (click)="openNextClarifyDialog()"
              matTooltip="Добавить уточнение к следующему фото" aria-label="Уточнение к следующему фото">
        <mat-icon>note_add</mat-icon>
      </button>
      <button mat-raised-button color="primary" (click)="retryPreview()">
        <mat-icon>autorenew</mat-icon>
        Повторить попытку
      </button>
      <button mat-stroked-button color="primary" (click)="takePhotoSystem()">
        <mat-icon>photo_camera</mat-icon>
        Системная камера
      </button>
      <button mat-mini-fab color="accent" (click)="openClarifyDialog()" [disabled]="clarifyLoading"
              matTooltip="Изменить время или уточнение последнего фото" aria-label="Редактировать уточнение">
        <mat-icon>edit</mat-icon>
      </button>
    </div>
  </div>
</div>

<mat-progress-bar *ngIf="uploadProgress !== null" [mode]="progressMode" [value]="uploadProgress"></mat-progress-bar>

<div class="last-shot" *ngIf="photoDataUrl">
  <img [src]="photoDataUrl" alt="snapshot" />
</div>

<div class="clarify-preview" *ngIf="nextClarifyDraft as draft">
  <div class="clarify-preview__header">
    <mat-icon>note_add</mat-icon>
    <span>Уточнение к следующему фото</span>
  </div>
  <div class="clarify-preview__body">
    <div class="clarify-preview__row" *ngIf="draft.note">
      <span class="clarify-preview__label">Текст:</span>
      <span class="clarify-preview__value">{{ draft.note }}</span>
    </div>
    <div class="clarify-preview__row" *ngIf="draft.time">
      <span class="clarify-preview__label">Время:</span>
      <span class="clarify-preview__value">{{ draft.time | date: 'HH:mm, d MMMM' }}</span>
    </div>
    <div class="clarify-preview__queued">
      Будет приложено к следующему фото
    </div>
  </div>
</div>

<div class="clarify-preview" *ngIf="clarifyPreview as preview">
  <div class="clarify-preview__header">
    <mat-icon>edit_note</mat-icon>
    <span>Уточнение к фото</span>
  </div>
  <div class="clarify-preview__body">
    <div class="clarify-preview__row" *ngIf="preview.note">
      <span class="clarify-preview__label">Текст:</span>
      <span class="clarify-preview__value">{{ preview.note }}</span>
    </div>
    <div class="clarify-preview__row">
      <span class="clarify-preview__label">Время:</span>
      <span class="clarify-preview__value">{{ preview.timeUtc | date: 'HH:mm, d MMMM' }}</span>
    </div>
    <div class="clarify-preview__queued" *ngIf="preview.queued">
      Отправлено на уточнение, ожидает обработки
    </div>
  </div>
</div>
