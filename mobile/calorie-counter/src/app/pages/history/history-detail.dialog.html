<div class="container">
  <img
    #photo
    *ngIf="data.item.hasImage && data.imageUrl"
    [src]="data.imageUrl"
    alt="meal"
    class="photo"
    (load)="fitDialog()"
  />

  <div class="macros">
    Б {{ data.item.proteinsG ?? '—' }} · Ж {{ data.item.fatsG ?? '—' }} · У {{ data.item.carbsG ?? '—' }} ·
    {{ data.item.caloriesKcal ?? '—' }} ккал
  </div>

  <div class="ingredients" *ngIf="data.item.ingredients?.length">
    Ингредиенты: {{ data.item.ingredients.join(', ') }}
  </div>

  <!-- Компактная таблица состава -->
  <div *ngIf="(data.item.products?.length || 0) > 0" class="composition">
    <table mat-table [dataSource]="data.item.products" class="products-table mat-elevation-z1">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef class="h name">Продукт</th>
        <td mat-cell *matCellDef="let p" class="c name">{{ p.name }}</td>
      </ng-container>

      <ng-container matColumnDef="percent">
        <th mat-header-cell *matHeaderCellDef class="h num">%</th>
        <td mat-cell *matCellDef="let p" class="c num">
          {{ p.percent == null ? '—' : (p.percent | number:'1.0-1') }}
        </td>
      </ng-container>

      <ng-container matColumnDef="grams">
        <th mat-header-cell *matHeaderCellDef class="h num">г</th>
        <td mat-cell *matCellDef="let p" class="c num">
          {{ p.grams == null ? '—' : (p.grams | number:'1.0-0') }}
        </td>
      </ng-container>

      <ng-container matColumnDef="proteins_g">
        <th mat-header-cell *matHeaderCellDef class="h num">Б</th>
        <td mat-cell *matCellDef="let p" class="c num">
          {{ p.proteins_g == null ? '—' : (p.proteins_g | number:'1.0-1') }}
        </td>
      </ng-container>

      <ng-container matColumnDef="fats_g">
        <th mat-header-cell *matHeaderCellDef class="h num">Ж</th>
        <td mat-cell *matCellDef="let p" class="c num">
          {{ p.fats_g == null ? '—' : (p.fats_g | number:'1.0-1') }}
        </td>
      </ng-container>

      <ng-container matColumnDef="carbs_g">
        <th mat-header-cell *matHeaderCellDef class="h num">У</th>
        <td mat-cell *matCellDef="let p" class="c num">
          {{ p.carbs_g == null ? '—' : (p.carbs_g | number:'1.0-1') }}
        </td>
      </ng-container>

      <ng-container matColumnDef="calories_kcal">
        <th mat-header-cell *matHeaderCellDef class="h num">ккал</th>
        <td mat-cell *matCellDef="let p" class="c num">
          {{ p.calories_kcal == null ? '—' : (p.calories_kcal | number:'1.0-0') }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="row head"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="row"></tr>
    </table>
  </div>

  <div class="buttons">
    <button mat-raised-button color="primary" (click)="openClarify()">Уточнить</button>
    <button mat-button color="warn" (click)="remove()">Удалить</button>
    <button mat-button (click)="dialogRef.close()">Закрыть</button>
  </div>
</div>
