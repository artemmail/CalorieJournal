<div class="container"
     infiniteScroll
     [scrollWindow]="false"
     [infiniteScrollContainer]="'.container'"
     [fromRoot]="true"
     [immediateCheck]="true"
     [infiniteScrollDistance]="1"
     [infiniteScrollThrottle]="200"
     (scrolled)="onScrollDown()">

  <ng-container *ngFor="let m of items; let i = index">
    <!-- –õ–∏–ø–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –î–ù–Ø: –¥–∞—Ç–∞ ¬∑ —Å—É—Ç–æ—á–Ω—ã–µ –∫–∫–∞–ª -->
    <div class="date-header" *ngIf="showDateSeparator(i)">
      <div class="header-row">
        <span class="header-left">{{ date(m.createdAtUtc) }}</span>
        <span class="dot">¬∑</span>
        <span class="header-right">{{ dateTotalFor(m.createdAtUtc) | number:'1.0-0' }} –∫–∫–∞–ª</span>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏—ë–º–∞ -->
    <mat-card class="meal-card" (click)="openDialog(m)" tabindex="0" aria-label="–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–∏—ë–º–∞">
      <div class="meal-card__grid">
        <!-- –§–æ—Ç–æ –±–µ–∑ –æ—Ç—Å—Ç—É–ø–æ–≤: –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—é –ª–µ–≤—É—é –ø–æ–ª–æ—Å—É –∫–∞—Ä—Ç–æ—á–∫–∏, –∫–≤–∞–¥—Ä–∞—Ç –ø–æ –ø–æ–ª–Ω–æ–π –≤—ã—Å–æ—Ç–µ -->
        <div class="meal-card__thumb" *ngIf="m.hasImage && imgUrl(m.id)">
          <img [src]="imgUrl(m.id)" alt="–§–æ—Ç–æ –±–ª—é–¥–∞" loading="lazy" decoding="async">
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏ —Å–ø—Ä–∞–≤–∞ -->
        <div class="meal-card__content">
          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ö–ê–†–¢–û–ß–ö–ò: –≤—Ä–µ–º—è ¬∑ –∫–∫–∞–ª (–µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å —Å –¥–Ω—ë–º) -->
          <div class="header-row -compact">
            <span class="header-left">{{ time(m.createdAtUtc) }}</span>
            <span class="dot">¬∑</span>
            <span class="header-right" >{{ m.caloriesKcal ?? "‚Äî" }} –∫–∫–∞–ª</span>
          </div>

          <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞ -->
          <div class="meal-card__title" [title]="m.dishName || ''">
            {{ m.dishName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}
          </div>

          <!-- –ß–∏–ø—ã –ë–ñ–£ + –≤–µ—Å -->
          <div class="meal-card__chips">
            <span class="chip">–ë {{ m.proteinsG ?? "‚Äî" }}</span>
            <span class="chip">–ñ {{ m.fatsG ?? "‚Äî" }}</span>
            <span class="chip">–£ {{ m.carbsG ?? "‚Äî" }}</span>
            <span class="chip" *ngIf="m.weightG">‚öñ {{ m.weightG }} –≥</span>
          </div>

          <div class="queued" *ngIf="m.updateQueued">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è‚Ä¶</div>
          <!-- –°–æ—Å—Ç–∞–≤ (–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã) ‚Äî —Å–∏–º–≤–æ–ª ‚öó -->
          <button type="button"
                  class="ingredients"
                  *ngIf="m.ingredients?.length"
                  (click)="$event.stopPropagation(); toggleIng(m)"
                  [attr.aria-expanded]="isIngOpen(m) ? 'true' : 'false'"
                  aria-label="–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–∞–≤ –±–ª—é–¥–∞">
            <span class="ingredients__icon" aria-hidden="true">üç£</span>
            <span class="ingredients__text" [class.-open]="isIngOpen(m)">
              {{ m.ingredients.join(', ') }}
            </span>
          </button>
        </div>
      </div>
    </mat-card>
  </ng-container>

  <div class="loading" *ngIf="loading">
    <mat-spinner diameter="32"></mat-spinner>
  </div>

  <div class="safe-area-bottom"></div>
</div>
