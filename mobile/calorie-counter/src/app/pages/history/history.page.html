<div class="container"
     infiniteScroll
     [scrollWindow]="false"
     [infiniteScrollContainer]="'.container'"
     [fromRoot]="true"
     [immediateCheck]="true"
     [infiniteScrollDistance]="1"
     [infiniteScrollThrottle]="200"
     (scrolled)="onScrollDown()">

  <ng-container *ngFor="let m of items; let i = index">
    <!-- –õ–∏–ø–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –î–ù–Ø: –¥–∞—Ç–∞ ¬∑ —Å—É—Ç–æ—á–Ω—ã–µ –∫–∫–∞–ª -->
    <div class="date-header" *ngIf="showDateSeparator(i)">
      <div class="header-row">
        <span class="header-left">{{ date(m.createdAtUtc) }}</span>
        <span class="dot">¬∑</span>
        <span class="header-right">{{ dateTotalFor(m.createdAtUtc) | number:'1.0-0' }} –∫–∫–∞–ª</span>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏—ë–º–∞ -->
    <mat-card
      class="meal-card"
      [class.meal-card--pending]="!!m.pendingRequestId"
      [class.meal-card--processing]="m.isProcessing"
      (click)="openDialog(m)"
      [attr.tabindex]="m.pendingRequestId ? -1 : 0"
      [attr.aria-disabled]="m.pendingRequestId ? 'true' : null"
      aria-label="–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–∏—ë–º–∞">
      <div class="meal-card__grid">
        <!-- –§–æ—Ç–æ –±–µ–∑ –æ—Ç—Å—Ç—É–ø–æ–≤: –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—é –ª–µ–≤—É—é –ø–æ–ª–æ—Å—É –∫–∞—Ä—Ç–æ—á–∫–∏, –∫–≤–∞–¥—Ä–∞—Ç –ø–æ –ø–æ–ª–Ω–æ–π –≤—ã—Å–æ—Ç–µ -->
        <div class="meal-card__thumb" *ngIf="m.hasImage">
          <ng-container *ngIf="imgUrl(m.id) as url; else thumbPlaceholder">
            <img [src]="url" alt="–§–æ—Ç–æ –±–ª—é–¥–∞" loading="lazy" decoding="async">
          </ng-container>
          <ng-template #thumbPlaceholder>
            <div class="meal-card__thumb-placeholder" aria-hidden="true"></div>
          </ng-template>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏ —Å–ø—Ä–∞–≤–∞ -->
        <div class="meal-card__content">
          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ö–ê–†–¢–û–ß–ö–ò: –≤—Ä–µ–º—è ¬∑ –∫–∫–∞–ª (–µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å —Å –¥–Ω—ë–º) -->
          <div class="header-row -compact">
            <span class="header-left">{{ time(m.createdAtUtc) }}</span>
            <span class="dot">¬∑</span>
            <span class="header-right" >{{ m.caloriesKcal ?? "‚Äî" }} –∫–∫–∞–ª</span>
          </div>

          <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞ -->
          <div class="meal-card__title" [title]="m.dishName || ''">
            {{ m.dishName || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}
          </div>

          <!-- –ß–∏–ø—ã –ë–ñ–£ + –≤–µ—Å -->
          <div class="meal-card__chips">
            <span class="chip">–ë {{ m.proteinsG ?? "‚Äî" }}</span>
            <span class="chip">–ñ {{ m.fatsG ?? "‚Äî" }}</span>
            <span class="chip">–£ {{ m.carbsG ?? "‚Äî" }}</span>
            <span class="chip" *ngIf="m.weightG">‚öñ {{ m.weightG }} –≥</span>
          </div>

          <div class="queued" *ngIf="m.isProcessing">{{ queueLabel(m) }}</div>
          <!-- –°–æ—Å—Ç–∞–≤ (–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã) ‚Äî —Å–∏–º–≤–æ–ª ‚öó -->
          <button type="button"
                  class="ingredients"
                  *ngIf="m.ingredients?.length"
                  (click)="$event.stopPropagation(); toggleIng(m)"
                  [attr.aria-expanded]="isIngOpen(m) ? 'true' : 'false'"
                  aria-label="–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–∞–≤ –±–ª—é–¥–∞">
            <span class="ingredients__icon" aria-hidden="true">üç£</span>
            <span class="ingredients__text" [class.-open]="isIngOpen(m)">
              {{ m.ingredients.join(', ') }}
            </span>
          </button>
        </div>
      </div>
    </mat-card>
  </ng-container>

  <div class="loading" *ngIf="loading">
    <mat-spinner diameter="32"></mat-spinner>
  </div>

  <div class="empty-state" *ngIf="!loading && items.length === 0">
    <ng-container *ngIf="isAnonymousMode; else linkedEmpty">
      –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –°–µ–π—á–∞—Å –≤—ã –≤ –∞–Ω–æ–Ω–∏–º–Ω–æ–º —Ä–µ–∂–∏–º–µ. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Telegram –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ê–∫–∫–∞—É–Ω—Ç¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å.
    </ng-container>
    <ng-template #linkedEmpty>
      –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ –µ–¥—ã –∏/–∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ Telegram-–±–æ—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ê–∫–∫–∞—É–Ω—Ç¬ª.
    </ng-template>
  </div>

  <div class="safe-area-bottom"></div>
</div>
