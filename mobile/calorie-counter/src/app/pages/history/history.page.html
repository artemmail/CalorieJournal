<div
  infiniteScroll
  [scrollWindow]="false"
  [infiniteScrollContainer]="'.container'"
  [fromRoot]="true"
  [immediateCheck]="true"
  [infiniteScrollDistance]="1"
  [infiniteScrollThrottle]="200"
  (scrolled)="onScrollDown()"
>
  <ng-container *ngFor="let m of items; let i = index">
    <div class="date" *ngIf="showDateSeparator(i)">
      {{ date(m.createdAtUtc) }}
      <span class="date-total">· {{ dateTotalFor(m.createdAtUtc) | number:'1.0-0' }} ккал</span>
    </div>

    <mat-card class="meal-card" (click)="openDialog(m)">
      <div class="row">
        <img *ngIf="m.hasImage && imgUrl(m.id)" [src]="imgUrl(m.id)" alt="meal" />
        <div class="info">
          <div class="time">{{ time(m.createdAtUtc) }}</div>
          <div class="kcal">
            {{ m.caloriesKcal ?? "—" }} ккал
            <span class="dish" *ngIf="m.dishName">· {{ m.dishName }}</span>
          </div>
          <div class="macros">
            Б {{ m.proteinsG ?? "—" }} · Ж {{ m.fatsG ?? "—" }} · У {{ m.carbsG ?? "—" }} · {{ m.weightG ?? "—" }} г
          </div>
          <div class="queued" *ngIf="m.updateQueued">Обновляется…</div>
          <div class="ing" *ngIf="m.ingredients?.length">Ингредиенты: {{ m.ingredients.join(", ") }}</div>
        </div>
      </div>
    </mat-card>
  </ng-container>

  <mat-spinner *ngIf="loading"></mat-spinner>
</div>
